<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>架构师内功心法，参与电商订单业务开发的状态模式详解 | 来一杯咖啡</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="状态模式在生活场景中也是比较常见的。比如我们平时网购的订单状态变化，还有平时坐电梯，电梯状态的变化。 在软件开发过程中，对于某一项的操作，可能存在不同的情况。通常处理多情况问题最直接的办法就是使用if…else或者switch…case条件语句进行判断。这种做法对于复杂状态的判断天然存在弊端：判断条件语句过于臃肿，可读性较差，不具备扩展性，维度难度也很大。如果转换一下思维，将这些不同状态独立起来用">
<meta property="og:type" content="article">
<meta property="og:title" content="架构师内功心法，参与电商订单业务开发的状态模式详解">
<meta property="og:url" content="https://xkjava.github.io/2020/03/21/%E6%9E%B6%E6%9E%84%E5%B8%88%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%EF%BC%8C%E5%8F%82%E4%B8%8E%E7%94%B5%E5%95%86%E8%AE%A2%E5%8D%95%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91%E7%9A%84%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/index.html">
<meta property="og:site_name" content="来一杯咖啡">
<meta property="og:description" content="状态模式在生活场景中也是比较常见的。比如我们平时网购的订单状态变化，还有平时坐电梯，电梯状态的变化。 在软件开发过程中，对于某一项的操作，可能存在不同的情况。通常处理多情况问题最直接的办法就是使用if…else或者switch…case条件语句进行判断。这种做法对于复杂状态的判断天然存在弊端：判断条件语句过于臃肿，可读性较差，不具备扩展性，维度难度也很大。如果转换一下思维，将这些不同状态独立起来用">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2020/3/20/170f6a106d4fecd1?w=744&h=564&f=png&s=113326">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2020/3/20/170f6a1e5d87254f?w=592&h=333&f=png&s=132053">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2020/3/20/170f76262cd00174?w=571&h=196&f=png&s=14631">
<meta property="article:published_time" content="2020-03-21T06:47:29.000Z">
<meta property="article:modified_time" content="2020-03-21T06:48:34.848Z">
<meta property="article:author" content="Kevin Shaw">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="Spring">
<meta property="article:tag" content="Netty">
<meta property="article:tag" content="Kafka...">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://user-gold-cdn.xitu.io/2020/3/20/170f6a106d4fecd1?w=744&h=564&f=png&s=113326">
  
    <link rel="alternate" href="/atom.xml" title="来一杯咖啡" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">来一杯咖啡</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">互联网技术无边界，学习与交流</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://xkjava.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-架构师内功心法，参与电商订单业务开发的状态模式详解" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/21/%E6%9E%B6%E6%9E%84%E5%B8%88%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%EF%BC%8C%E5%8F%82%E4%B8%8E%E7%94%B5%E5%95%86%E8%AE%A2%E5%8D%95%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91%E7%9A%84%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/" class="article-date">
  <time datetime="2020-03-21T06:47:29.000Z" itemprop="datePublished">2020-03-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      架构师内功心法，参与电商订单业务开发的状态模式详解
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>状态模式在生活场景中也是比较常见的。比如我们平时网购的订单状态变化，还有平时坐电梯，电梯状态的变化。<br><img src="https://user-gold-cdn.xitu.io/2020/3/20/170f6a106d4fecd1?w=744&h=564&f=png&s=113326" alt=""><br><img src="https://user-gold-cdn.xitu.io/2020/3/20/170f6a1e5d87254f?w=592&h=333&f=png&s=132053" alt=""></p>
<p>在软件开发过程中，对于某一项的操作，可能存在不同的情况。通常处理多情况问题最直接的办法就是使用if…else或者switch…case条件语句进行判断。这种做法对于复杂状态的判断天然存在弊端：判断条件语句过于臃肿，可读性较差，不具备扩展性，维度难度也很大。如果转换一下思维，将这些不同状态独立起来用各种不同的类进行表示，系统处理哪种情况，直接使用相应的状态类进行处理，消除条件判断语句，代码也更加具有层次感，且具备良好的扩展能力。</p>
<p>状态模式（State Pattern）也成为状态机模式（State Machine Pattern），是允许对象在内部状态发生改变时改变它的行为，对象看起来好像修改了它的类。状态模式中类的行为是由状态决定的，不同的状态下有不同的行为。其意图是让一个对象在其内部改变的时候，其行为也随之改变。状态模式的核心就是状态与行为绑定，不同的状态对应不同的行为。</p>
<h1 id="一、状态模式的应用场景"><a href="#一、状态模式的应用场景" class="headerlink" title="一、状态模式的应用场景"></a>一、状态模式的应用场景</h1><p>状态模式适用于以下几种场景：</p>
<ul>
<li>行为随状态改变而改变场景；</li>
<li>一个操作中含有庞大的多分支机构，并且这些分支取决于对象的状态。</li>
</ul>
<p>状态模式主要包含三种角色：</p>
<ul>
<li>环境类角色（Context）：定义客户端需要的接囗，内部维护一个当前状态实例，并负责具体状态的切换；</li>
<li>抽象状态角色（State）：定义该状态下的行为，可以有一个或多个行为；</li>
<li>具体状态角色（ConcreteState）：具体实现该状态对应的行为并且在需要的肩况下进行状态切换。</li>
</ul>
<h2 id="1-1-状态模式在业务场景中的应用"><a href="#1-1-状态模式在业务场景中的应用" class="headerlink" title="1.1 状态模式在业务场景中的应用"></a>1.1 状态模式在业务场景中的应用</h2><p>我们在某社区阅读文章的时候，如果觉得某篇文章写得好，就会转发、收藏并且评论。如果用户处于登录情况下，我们就可以做评论、转发、收藏这些行为。否则需要跳转到登录页面，登录之后才能执行先前的动作。那么这里涉及到的状态有两种：已登录和未登录，行为有三种：评论、转发、收藏。下面使用代码来实现这些逻辑，首先创建抽象状态角色类UserState：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public abstract class UserState &#123;</span><br><span class="line"></span><br><span class="line">    private AppContext appContext;</span><br><span class="line"></span><br><span class="line">    public void setAppContext(AppContext appContext) &#123;</span><br><span class="line">        this.appContext &#x3D; appContext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public abstract void forward();</span><br><span class="line"></span><br><span class="line">    public abstract void collect();</span><br><span class="line"></span><br><span class="line">    public abstract void comment(String comment);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>创建登录状态LoginState类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public class LoginState extends UserState &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void forward() &#123;</span><br><span class="line">        System.out.println(&quot;转发成功！&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void collect() &#123;</span><br><span class="line">        System.out.println(&quot;收藏成功！&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void comment(String comment) &#123;</span><br><span class="line">        System.out.println(&quot;评论成功,内容是：&quot; + comment);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接着创建未登录状态UnLoginState类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public class UnLoginState extends UserState &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void forward() &#123;</span><br><span class="line">        forward2Login();</span><br><span class="line">        this.appContext.forward();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void collect() &#123;</span><br><span class="line">        forward2Login();</span><br><span class="line">        this.appContext.collect();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void comment(String comment) &#123;</span><br><span class="line">        forward2Login();</span><br><span class="line">        this.appContext.comment(comment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void forward2Login() &#123;</span><br><span class="line">        System.out.println(&quot;跳转到登录页面！&quot;);</span><br><span class="line">        this.appContext.setState(this.appContext.LOGIN_STATE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>创建上下文角色AppContext类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">public class AppContext &#123;</span><br><span class="line"></span><br><span class="line">    public static final UserState LOGIN_STATE &#x3D; new LoginState();</span><br><span class="line"></span><br><span class="line">    public static final UserState UNLOGIN_STATE &#x3D; new UnLoginState();</span><br><span class="line"></span><br><span class="line">    private UserState currentState &#x3D; UNLOGIN_STATE;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        UNLOGIN_STATE.setAppContext(this);</span><br><span class="line">        LOGIN_STATE.setAppContext(this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setState(UserState state) &#123;</span><br><span class="line">        this.currentState &#x3D; state;</span><br><span class="line">        this.currentState.setAppContext(this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public UserState getState() &#123;</span><br><span class="line">        return this.currentState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void forward() &#123;</span><br><span class="line">        this.currentState.forward();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void collect() &#123;</span><br><span class="line">        this.currentState.collect();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void comment(String comment) &#123;</span><br><span class="line">        this.currentState.comment(comment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试main方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> public static void main(String[] args) &#123;</span><br><span class="line">    AppContext context &#x3D; new AppContext();</span><br><span class="line">    context.forward();</span><br><span class="line">    context.collect();</span><br><span class="line">    context.comment(&quot;说的太好了，双手双脚给个赞������&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/3/20/170f76262cd00174?w=571&h=196&f=png&s=14631" alt=""></p>
<h2 id="1-2-利用状态机实现订单状态流转控制"><a href="#1-2-利用状态机实现订单状态流转控制" class="headerlink" title="1.2 利用状态机实现订单状态流转控制"></a>1.2 利用状态机实现订单状态流转控制</h2><p>状态机是状态模式的一种应用，相当于上下文角色的一个升级版本。在工作流或游戏等各种系统中有大量使用，比如各种工作流引擎，它几乎是状态机的子集和实现，封装状态的变化规则。Spring提供了一个很好的解决方案。Spring的组件名称就叫StateMachine（状态机）。状态机帮助开发者简化状态控制的开发过程，让状态机结构更加层次化。下面来用Spring状态机模拟一个订单状态流转的过程。</p>
<p>1、pom依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.statemachine&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-statemachine-core&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.0.1.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>2、创建订单实体类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">public class Order &#123;</span><br><span class="line">    private int id;</span><br><span class="line">    private OrderStatus status;</span><br><span class="line">    public void setStatus(OrderStatus status) &#123;</span><br><span class="line">        this.status &#x3D; status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public OrderStatus getStatus() &#123;</span><br><span class="line">        return status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(int id) &#123;</span><br><span class="line">        this.id &#x3D; id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;订单号：&quot; + id + &quot;, 订单状态：&quot; + status;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、创建订单状态枚举类和状态转换枚举类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 订单状态</span><br><span class="line"> *&#x2F;</span><br><span class="line">public enum OrderStatus &#123;</span><br><span class="line">    &#x2F;&#x2F; 待支付，待发货，待收货，订单结束</span><br><span class="line">    WAIT_PAYMENT, WAIT_DELIVER, WAIT_RECEIVE, FINISH;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 订单状态改变事件</span><br><span class="line"> *&#x2F;</span><br><span class="line">public enum OrderStatusChangeEvent &#123;</span><br><span class="line">    &#x2F;&#x2F; 支付，发货，确认收货</span><br><span class="line">    PAYED, DELIVERY, RECEIVED;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4、添加状态流转配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 订单状态机配置</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Configuration</span><br><span class="line">@EnableStateMachine(name &#x3D; &quot;orderStateMachine&quot;)</span><br><span class="line">public class OrderStateMachineConfig extends StateMachineConfigurerAdapter&lt;OrderStatus, OrderStatusChangeEvent&gt; &#123;</span><br><span class="line"> </span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 配置状态</span><br><span class="line">     * @param states</span><br><span class="line">     * @throws Exception</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public void configure(StateMachineStateConfigurer&lt;OrderStatus, OrderStatusChangeEvent&gt; states) throws Exception &#123;</span><br><span class="line">        states</span><br><span class="line">                .withStates()</span><br><span class="line">                .initial(OrderStatus.WAIT_PAYMENT)</span><br><span class="line">                .states(EnumSet.allOf(OrderStatus.class));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 配置状态转换事件关系</span><br><span class="line">     * @param transitions</span><br><span class="line">     * @throws Exception</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public void configure(StateMachineTransitionConfigurer&lt;OrderStatus, OrderStatusChangeEvent&gt; transitions) throws Exception &#123;</span><br><span class="line">        transitions</span><br><span class="line">                .withExternal().source(OrderStatus.WAIT_PAYMENT).target(OrderStatus.WAIT_DELIVER).event(OrderStatusChangeEvent.PAYED)</span><br><span class="line">                .and()</span><br><span class="line">                .withExternal().source(OrderStatus.WAIT_DELIVER).target(OrderStatus.WAIT_RECEIVE).event(OrderStatusChangeEvent.DELIVERY)</span><br><span class="line">                .and()</span><br><span class="line">                .withExternal().source(OrderStatus.WAIT_RECEIVE).target(OrderStatus.FINISH).event(OrderStatusChangeEvent.RECEIVED);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 持久化配置</span><br><span class="line">     * 实际使用中，可以配合redis等，进行持久化操作</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Bean</span><br><span class="line">    public DefaultStateMachinePersister persister()&#123;</span><br><span class="line">        return new DefaultStateMachinePersister&lt;&gt;(new StateMachinePersist&lt;Object, Object, Order&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void write(StateMachineContext&lt;Object, Object&gt; context, Order order) throws Exception &#123;</span><br><span class="line">                &#x2F;&#x2F;此处并没有进行持久化操作</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            @Override</span><br><span class="line">            public StateMachineContext&lt;Object, Object&gt; read(Order order) throws Exception &#123;</span><br><span class="line">                &#x2F;&#x2F;此处直接获取order中的状态，其实并没有进行持久化读取操作</span><br><span class="line">                return new DefaultStateMachineContext(order.getStatus(), null, null, null);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>5、添加订单状态监听器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">@Component(&quot;orderStateListener&quot;)</span><br><span class="line">@WithStateMachine(name &#x3D; &quot;orderStateMachine&quot;)</span><br><span class="line">public class OrderStateListenerImpl&#123;</span><br><span class="line"> </span><br><span class="line">    @OnTransition(source &#x3D; &quot;WAIT_PAYMENT&quot;, target &#x3D; &quot;WAIT_DELIVER&quot;)</span><br><span class="line">    public boolean payTransition(Message&lt;OrderStatusChangeEvent&gt; message) &#123;</span><br><span class="line">        Order order &#x3D; (Order) message.getHeaders().get(&quot;order&quot;);</span><br><span class="line">        order.setStatus(OrderStatus.WAIT_DELIVER);</span><br><span class="line">        System.out.println(&quot;支付，状态机反馈信息：&quot; + message.getHeaders().toString());</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    @OnTransition(source &#x3D; &quot;WAIT_DELIVER&quot;, target &#x3D; &quot;WAIT_RECEIVE&quot;)</span><br><span class="line">    public boolean deliverTransition(Message&lt;OrderStatusChangeEvent&gt; message) &#123;</span><br><span class="line">        Order order &#x3D; (Order) message.getHeaders().get(&quot;order&quot;);</span><br><span class="line">        order.setStatus(OrderStatus.WAIT_RECEIVE);</span><br><span class="line">        System.out.println(&quot;发货，状态机反馈信息：&quot; + message.getHeaders().toString());</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    @OnTransition(source &#x3D; &quot;WAIT_RECEIVE&quot;, target &#x3D; &quot;FINISH&quot;)</span><br><span class="line">    public boolean receiveTransition(Message&lt;OrderStatusChangeEvent&gt; message)&#123;</span><br><span class="line">        Order order &#x3D; (Order) message.getHeaders().get(&quot;order&quot;);</span><br><span class="line">        order.setStatus(OrderStatus.FINISH);</span><br><span class="line">        System.out.println(&quot;收货，状态机反馈信息：&quot; + message.getHeaders().toString());</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>6、创建IOrderService接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public interface IOrderService &#123;</span><br><span class="line">    &#x2F;&#x2F;创建新订单</span><br><span class="line">    Order create();</span><br><span class="line">    &#x2F;&#x2F;发起支付</span><br><span class="line">    Order pay(int id);</span><br><span class="line">    &#x2F;&#x2F;订单发货</span><br><span class="line">    Order deliver(int id);</span><br><span class="line">    &#x2F;&#x2F;订单收货</span><br><span class="line">    Order receive(int id);</span><br><span class="line">    &#x2F;&#x2F;获取所有订单信息</span><br><span class="line">    Map&lt;Integer, Order&gt; getOrders();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>7、在Service中添加业务逻辑</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">@Service(&quot;orderService&quot;)</span><br><span class="line">public class OrderServiceImpl implements IOrderService &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private StateMachine&lt;OrderStatus, OrderStatusChangeEvent&gt; orderStateMachine;</span><br><span class="line"> </span><br><span class="line">    @Autowired</span><br><span class="line">    private StateMachinePersister&lt;OrderStatus, OrderStatusChangeEvent, Order&gt; persister;</span><br><span class="line"> </span><br><span class="line">    private int id &#x3D; 1;</span><br><span class="line">    private Map&lt;Integer, Order&gt; orders &#x3D; new HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    public Order create() &#123;</span><br><span class="line">        Order order &#x3D; new Order();</span><br><span class="line">        order.setStatus(OrderStatus.WAIT_PAYMENT);</span><br><span class="line">        order.setId(id++);</span><br><span class="line">        orders.put(order.getId(), order);</span><br><span class="line">        return order;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Order pay(int id) &#123;</span><br><span class="line">        Order order &#x3D; orders.get(id);</span><br><span class="line">        System.out.println(&quot;线程名称：&quot; + Thread.currentThread().getName() + &quot; 尝试支付，订单号：&quot; + id);</span><br><span class="line">        Message message &#x3D; MessageBuilder.withPayload(OrderStatusChangeEvent.PAYED).setHeader(&quot;order&quot;, order).build();</span><br><span class="line">        if (!sendEvent(message, order)) &#123;</span><br><span class="line">            System.out.println(&quot;线程名称：&quot; + Thread.currentThread().getName() + &quot; 支付失败, 状态异常，订单号：&quot; + id);</span><br><span class="line">        &#125;</span><br><span class="line">        return orders.get(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Order deliver(int id) &#123;</span><br><span class="line">        Order order &#x3D; orders.get(id);</span><br><span class="line">        System.out.println(&quot;线程名称：&quot; + Thread.currentThread().getName() + &quot; 尝试发货，订单号：&quot; + id);</span><br><span class="line">        if (!sendEvent(MessageBuilder.withPayload(OrderStatusChangeEvent.DELIVERY).setHeader(&quot;order&quot;, order).build(), orders.get(id))) &#123;</span><br><span class="line">            System.out.println(&quot;线程名称：&quot; + Thread.currentThread().getName() + &quot; 发货失败，状态异常，订单号：&quot; + id);</span><br><span class="line">        &#125;</span><br><span class="line">        return orders.get(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Order receive(int id) &#123;</span><br><span class="line">        Order order &#x3D; orders.get(id);</span><br><span class="line">        System.out.println(&quot;线程名称：&quot; + Thread.currentThread().getName() + &quot; 尝试收货，订单号：&quot; + id);</span><br><span class="line">        if (!sendEvent(MessageBuilder.withPayload(OrderStatusChangeEvent.RECEIVED).setHeader(&quot;order&quot;, order).build(), orders.get(id))) &#123;</span><br><span class="line">            System.out.println(&quot;线程名称：&quot; + Thread.currentThread().getName() + &quot; 收货失败，状态异常，订单号：&quot; + id);</span><br><span class="line">        &#125;</span><br><span class="line">        return orders.get(id);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    public Map&lt;Integer, Order&gt; getOrders() &#123;</span><br><span class="line">        return orders;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 发送订单状态转换事件</span><br><span class="line">     *</span><br><span class="line">     * @param message</span><br><span class="line">     * @param order</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private synchronized boolean sendEvent(Message&lt;OrderStatusChangeEvent&gt; message, Order order) &#123;</span><br><span class="line">        boolean result &#x3D; false;</span><br><span class="line">        try &#123;</span><br><span class="line">            orderStateMachine.start();</span><br><span class="line">            &#x2F;&#x2F;尝试恢复状态机状态</span><br><span class="line">            persister.restore(orderStateMachine, order);</span><br><span class="line">            &#x2F;&#x2F;添加延迟用于线程安全测试</span><br><span class="line">            Thread.sleep(1000);</span><br><span class="line">            result &#x3D; orderStateMachine.sendEvent(message);</span><br><span class="line">            &#x2F;&#x2F;持久化状态机状态</span><br><span class="line">            persister.persist(orderStateMachine, order);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            orderStateMachine.stop();</span><br><span class="line">        &#125;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试main方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">    Thread.currentThread().setName(&quot;主线程&quot;);</span><br><span class="line"></span><br><span class="line">    ConfigurableApplicationContext context &#x3D; SpringApplication.run(Test.class,args);</span><br><span class="line"></span><br><span class="line">    IOrderService orderService &#x3D; (IOrderService)context.getBean(&quot;orderService&quot;);</span><br><span class="line"></span><br><span class="line">    orderService.create();</span><br><span class="line">    orderService.create();</span><br><span class="line"></span><br><span class="line">    orderService.pay(1);</span><br><span class="line"></span><br><span class="line">    new Thread(&quot;客户线程&quot;)&#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            orderService.deliver(1);</span><br><span class="line">            orderService.receive(1);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;.start();</span><br><span class="line"></span><br><span class="line">    orderService.pay(2);</span><br><span class="line">    orderService.deliver(2);</span><br><span class="line">    orderService.receive(2);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;全部订单状态：&quot; + orderService.getOrders());</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="二、状态模式中的源码体现"><a href="#二、状态模式中的源码体现" class="headerlink" title="二、状态模式中的源码体现"></a>二、状态模式中的源码体现</h1><p>状态模式的具体应用在源码中非常少见，在源码中一般只是提供一种通用的解决方案。如果一定要找，当然也是能找到的。经历千辛万苦，持续烧脑，下面我们来看一个在JSF源码中的Lifecycle类。JSF也算是一个比较经典的前端框架，那么没用过的小伙伴也没关系，我们这是只是分析一下其设计思想。在JSF中它所有页面的处理分为6个阶段，被定义在了Phaseld类中用不同的常量来表示生命周期阶段，源码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">public class PhaseId implements Comparable &#123;</span><br><span class="line">    private final int ordinal;</span><br><span class="line">    private String phaseName;</span><br><span class="line">    private static int nextOrdinal &#x3D; 0;</span><br><span class="line">    private static final String ANY_PHASE_NAME &#x3D; &quot;ANY&quot;;</span><br><span class="line">    public static final PhaseId ANY_PHASE &#x3D; new PhaseId(&quot;ANY&quot;);</span><br><span class="line">    private static final String RESTORE_VIEW_NAME &#x3D; &quot;RESTORE_VIEW&quot;;</span><br><span class="line">    public static final PhaseId RESTORE_VIEW &#x3D; new PhaseId(&quot;RESTORE_VIEW&quot;);</span><br><span class="line">    private static final String APPLY_REQUEST_VALUES_NAME &#x3D; &quot;APPLY_REQUEST_VALUES&quot;;</span><br><span class="line">    public static final PhaseId APPLY_REQUEST_VALUES &#x3D; new PhaseId(&quot;APPLY_REQUEST_VALUES&quot;);</span><br><span class="line">    private static final String PROCESS_VALIDATIONS_NAME &#x3D; &quot;PROCESS_VALIDATIONS&quot;;</span><br><span class="line">    public static final PhaseId PROCESS_VALIDATIONS &#x3D; new PhaseId(&quot;PROCESS_VALIDATIONS&quot;);</span><br><span class="line">    private static final String UPDATE_MODEL_VALUES_NAME &#x3D; &quot;UPDATE_MODEL_VALUES&quot;;</span><br><span class="line">    public static final PhaseId UPDATE_MODEL_VALUES &#x3D; new PhaseId(&quot;UPDATE_MODEL_VALUES&quot;);</span><br><span class="line">    private static final String INVOKE_APPLICATION_NAME &#x3D; &quot;INVOKE_APPLICATION&quot;;</span><br><span class="line">    public static final PhaseId INVOKE_APPLICATION &#x3D; new PhaseId(&quot;INVOKE_APPLICATION&quot;);</span><br><span class="line">    private static final String RENDER_RESPONSE_NAME &#x3D; &quot;RENDER_RESPONSE&quot;;</span><br><span class="line">    public static final PhaseId RENDER_RESPONSE &#x3D; new PhaseId(&quot;RENDER_RESPONSE&quot;);</span><br><span class="line">    private static final PhaseId[] values;</span><br><span class="line">    public static final List VALUES;</span><br><span class="line"></span><br><span class="line">    private PhaseId(String newPhaseName) &#123;</span><br><span class="line">        this.ordinal &#x3D; nextOrdinal++;</span><br><span class="line">        this.phaseName &#x3D; null;</span><br><span class="line">        this.phaseName &#x3D; newPhaseName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int compareTo(Object other) &#123;</span><br><span class="line">        return this.ordinal - ((PhaseId)other).ordinal;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getOrdinal() &#123;</span><br><span class="line">        return this.ordinal;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return null &#x3D;&#x3D; this.phaseName ? String.valueOf(this.ordinal) : this.phaseName + &#39; &#39; + this.ordinal;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static &#123;</span><br><span class="line">        values &#x3D; new PhaseId[]&#123;ANY_PHASE, RESTORE_VIEW, APPLY_REQUEST_VALUES, PROCESS_VALIDATIONS, UPDATE_MODEL_VALUES, INVOKE_APPLICATION, RENDER_RESPONSE&#125;;</span><br><span class="line">        VALUES &#x3D; Collections.unmodifiableList(Arrays.asList(values));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么这些状态的切换都在Lifecycle的execute()方、去中进行。其中会传一个参数FacesContext对象，最终所有的状态都被FacesContext保存。在此呢，我们就不做继续深入的分析。</p>
<h1 id="三、状态模式的相关模式"><a href="#三、状态模式的相关模式" class="headerlink" title="三、状态模式的相关模式"></a>三、状态模式的相关模式</h1><h2 id="3-1-状态模式与责任链模式"><a href="#3-1-状态模式与责任链模式" class="headerlink" title="3.1 状态模式与责任链模式"></a>3.1 状态模式与责任链模式</h2><p>状态模式和责任链模式都能消除if分支过多的问题。但某些情况下，状态模式中的状态可以理解为责任，那么这种情况下，两种模式都可以使用。</p>
<p>从定义来看，状态模式强调的是一个对象内在状态的改变，而责任链模式强调的是外部节点对象间的改变。</p>
<p>从其代码实现上来看，他们间最大的区别就是状态模式各个状态对象知道自己下一个要进入的状态对象而责任链模式并不清楚其下一个节点处理对象，因为链式组装由客户端负责。</p>
<h2 id="3-2-状态模式与策略模式"><a href="#3-2-状态模式与策略模式" class="headerlink" title="3.2 状态模式与策略模式"></a>3.2 状态模式与策略模式</h2><p>状态模式和策略模式的UML类图架构几乎完全一样，但他们的应用场景是不一样的。策略模式多种算法行为择其一都能满足，彼此之间是独立的用户可自行更换策略算法，而状态模式各个状态间是存在相互关系的，彼此之间在一定条件下存在自动切换状态效果，且用户无法指定状态，只能设置初始状态。</p>
<h1 id="四、状态模式的优缺点"><a href="#四、状态模式的优缺点" class="headerlink" title="四、状态模式的优缺点"></a>四、状态模式的优缺点</h1><p>优点：</p>
<ul>
<li>结构清晰：将状态独立为类，消除了冗余的if…else或switch…case语句，使代码更加简洁，提高系统可维护性；</li>
<li>将状态转换显示化通常的对象内部都是使用数值类型来定义状态，状态的切换是通过賦值进行表现，不够直观，而使用状态类，在切换状态时，是以不同的类进行表示，转换目的更加明确；</li>
<li>状态类职责明确且具备扩展性。</li>
</ul>
<p>缺点：</p>
<ul>
<li>类膨胀：如果一个事物具备很多状态，则会造成状态类太多；</li>
<li>状态模式的结构与实现都较为复杂，如果使用不当将导致程序结构和代码的混乱；</li>
<li>状态模式对开闭原则的支持并不太好，对于可以切换状态的状态模式增加新的状态类需要修改那些负责状态转换的源代码，否则无法切换到新增状态，而且修改某个状态类的行为也需修改对应类的源代码。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://xkjava.github.io/2020/03/21/%E6%9E%B6%E6%9E%84%E5%B8%88%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%EF%BC%8C%E5%8F%82%E4%B8%8E%E7%94%B5%E5%95%86%E8%AE%A2%E5%8D%95%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91%E7%9A%84%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/" data-id="ckbnhdd9l000rnvra7eon9evn" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/03/22/%E6%9E%B6%E6%9E%84%E5%B8%88%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%EF%BC%8C%E5%8F%82%E4%B8%8E%E5%AF%8C%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8%E5%BC%80%E5%8F%91%E7%9A%84%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          架构师内功心法，参与富文本编辑器开发的备忘录模式详解
        
      </div>
    </a>
  
  
    <a href="/2020/03/21/%E6%9E%B6%E6%9E%84%E5%B8%88%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%EF%BC%8C%E7%86%9F%E6%82%89%E7%94%B5%E8%84%91%E4%B8%AD%E7%9A%84%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">架构师内功心法，熟悉电脑中的操作系统的命令模式详解</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/06/20/JAVA%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E7%AF%87%EF%BC%8C%E8%A7%A3%E5%86%B3%E6%AD%BB%E9%94%81%E9%97%AE%E9%A2%98%E4%BB%A5%E5%8F%8AThreadLocal%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/">JAVA并发编程阶段总结篇，解决死锁问题以及ThreadLocal原理分析</a>
          </li>
        
          <li>
            <a href="/2020/05/30/JAVA%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E9%80%92%E8%BF%9B%E7%AF%87%EF%BC%8C%E6%8E%A2%E7%B4%A2%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E6%80%A7volatile%E5%85%B3%E9%94%AE%E5%AD%97%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E5%8F%AF%E8%A7%81%E6%80%A7/">JAVA并发编程递进篇，探索线程安全性volatile关键字如何保证可见性</a>
          </li>
        
          <li>
            <a href="/2020/05/23/JAVA%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8%E7%AF%87%EF%BC%8C%E6%80%9D%E8%80%83%E5%90%8C%E6%AD%A5%E9%94%81Synchronized%E8%83%8C%E5%90%8E%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%93%B2%E5%AD%A6/">JAVA并发编程入门篇，思考同步锁Synchronized背后的实现哲学</a>
          </li>
        
          <li>
            <a href="/2020/05/18/JAVA%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E6%8F%AD%E5%BC%80%E7%AF%87%E7%AB%A0%EF%BC%8C%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9F%BA%E6%9C%AC%E8%AE%A4%E8%AF%86%EF%BC%8C%E4%BA%86%E8%A7%A3%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%84%8F%E4%B9%89%E5%92%8C%E4%BD%BF%E7%94%A8/">JAVA并发编程揭开篇章，并发编程基本认识，了解多线程意义和使用</a>
          </li>
        
          <li>
            <a href="/2020/05/15/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E9%98%85%E8%AF%BBmybatis%E6%A0%B8%E5%BF%83%E6%BA%90%E7%A0%81%EF%BC%8C%E6%8E%8C%E6%8F%A1%E5%BA%95%E5%B1%82%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E4%B8%8E%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/">手把手教你阅读mybatis核心源码，掌握底层工作原理与设计思想</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Kevin Shaw<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>